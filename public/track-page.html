<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <link rel="stylesheet" href="styles/track-page.css">
        <link rel="icon" type="image/x-icon" href="assets/images/calorieWiseFaviconNew.jpg">

        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Courier+Prime:ital,wght@0,400;0,700;1,400;1,700&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Quicksand:wght@300..700&display=swap" rel="stylesheet">

        <title>Track | CalorieWise</title>
        <style>
            /* Additional styles for the graph components */
            .calorie-graph-section {
                padding: 20px;
                background-color: var(--white);
                border-radius: 15px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
                margin: 20px auto 40px;
                max-width: 950px;
            }

            .calorie-graph-section canvas {
                max-height: 400px;
            }

            .calorie-graph-section h2 {
                color: var(--navy);
                font-family: "Quicksand", sans-serif;
                font-size: 1.6rem;
                margin-bottom: 20px;
                text-align: center;
            }

            .weekly-stats {
                display: grid;
                grid-template-columns: repeat(4, 1fr);
                gap: 15px;
                max-width: 950px;
                margin: 0 auto 30px;
            }

            .stat-card {
                background-color: #f8f8f8;
                border-radius: 12px;
                padding: 15px;
                text-align: center;
            }

            .stat-card .stat-label {
                color: #666;
                font-size: 0.9rem;
                margin-bottom: 8px;
            }

            .stat-card .stat-value {
                color: var(--navy);
                font-size: 1.4rem;
                font-weight: bold;
            }

            .mini-tile-layout {
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
                gap: 15px;
                padding: 20px;
                max-width: 950px;
                margin: 0 auto;
            }

            .mini-tile {
                border-radius: 20px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
                padding: 15px;
                display: flex;
                align-items: center;
                gap: 10px;
                width: 170px;
                height: 60px;
                transition: transform 0.2s ease;
            }

            .mini-tile-content h3 {
                margin: 0;
                font-size: 16px;
                font-weight: 600;
                color: #fff;
            }

            .mini-tile-content p {
                margin: 0;
                font-size: 12px;
                color: #eee;
            }
        </style>
    </head>
<body>

  <!-- Keep original header -->
  <header>
    <h1 class="homeTitle">
      <a  id="home-link" href="home-page.html">
        <span id="calorie">Calorie</span><span id="wise">Wise</span>
      </a>

        <button class="settings-button" aria-label="Settings" aria-expanded="false" aria-controls="settings-menu">
            &#9881;
        </button>
    
        <div class="settings-dropdown" id="settings-menu" hidden>
            <ul>
                <li><a href="#">Account</a></li>
                <li><a href="#">Settings</a></li>
                <li><hr></li>
                <li><a href="#">Logout</a></li>
            </ul>
        </div>
    </h1>
  </header>

  <main>
    <!-- Mini tiles for daily metrics -->
    <div class="mini-tile-layout">
      <!-- Calories Tile -->
      <div class="mini-tile orange-tile">
        <div class="tile-icon">üî•</div>
        <div class="mini-tile-content">
          <h3>187 kcal</h3>
          <p>Calories Burned Today</p>
        </div>
      </div>
      
      <!-- Water Tile -->
      <div class="mini-tile green-tile">
        <div class="tile-icon">üíß</div>
        <div class="mini-tile-content">
          <h3>2.5L</h3>
          <p>Water Intake Today</p>
        </div>
      </div>
      
      <!-- Exercise Tile -->
      <div class="mini-tile green-tile">
        <div class="tile-icon">üèãÔ∏è</div>
        <div class="mini-tile-content">
          <h3>12 min</h3>
          <p>Exercise Today</p>
        </div>
      </div>
      
      <!-- Sleep Tile -->
      <div class="mini-tile orange-tile">
        <div class="tile-icon">üõèÔ∏è</div>
        <div class="mini-tile-content">
          <h3>7.8 hrs</h3>
          <p>Sleep Today</p>
        </div>
      </div>
      
      <!-- Steps Tile -->
      <div class="mini-tile navy-tile">
        <div class="tile-icon">üë£</div>
        <div class="mini-tile-content">
          <h3>7,641</h3>
          <p>Steps Today</p>
        </div>
      </div>
    </div>

    <!-- Main Calorie Graph Section -->
    <section class="calorie-graph-section">
      <h2>Calories In vs Calories Out</h2>
      <canvas id="calorieChart" width="900" height="400" style="height: 400px;"></canvas>
    </section>

    <!-- Weekly Stats Section -->
    <div class="weekly-stats">
      <div class="stat-card">
        <div class="stat-label">Avg. Calories In</div>
        <div class="stat-value">2,050</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Avg. Calories Burned</div>
        <div class="stat-value">2,036</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Net Calories</div>
        <div class="stat-value">+98</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Active Days</div>
        <div class="stat-value">6/7</div>
      </div>
    </div>
  </main>

  <!-- Keep original bottom nav -->
  <nav class="bottom-nav">
    <a href="#" class="nav-item" aria-label="Log Food" onclick="location.href='log-food-page.html'"> 
      <span class="nav-icon">&#x1F34E;</span>
        <span class="nav-label">Log Food</span>
    </a>
    <a href="#" class="nav-item" aria-label="Track">
        <span class="nav-icon">&#x1F4C8;</span>
        <span class="nav-label">Track</span>
    </a>
    <a class="nav-item" aria-label="Log Exercise" onclick="location.href='log-exercise-page.html'">
        <span class="nav-icon">&#x1F3C3;</span>
        <span class="nav-label">Log Exercise</span>
    </a>
  </nav>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    // Fetch calorie history and render the chart dynamically
    const username = localStorage.getItem('username');
    fetch('/getCalorieHistory', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ username })
    })
    .then(res => res.json())
    .then(data => {
      const dates = data.map(entry => entry.date);
      const caloriesIn = data.map(entry => Number(entry.in));
      const caloriesBurned = data.map(entry => Number(entry.out));

      // Initialize Chart.js with dynamic data
      const ctx = document.getElementById('calorieChart').getContext('2d');
      new Chart(ctx, {
        type: 'line',
        data: {
          labels: dates,
          datasets: [
            {
              label: 'Calories In',
              data: caloriesIn,
              borderColor: 'rgba(244, 122, 78, 1)',
              backgroundColor: 'rgba(244, 122, 78, 0.1)',
              tension: 0.4,
              borderWidth: 3,
              pointBackgroundColor: 'rgba(244, 122, 78, 1)',
              fill: true
            },
            {
              label: 'Calories Out',
              data: caloriesBurned,
              borderColor: 'rgba(42, 180, 116, 1)',
              backgroundColor: 'rgba(42, 180, 116, 0.1)',
              tension: 0.4,
              borderWidth: 3,
              pointBackgroundColor: 'rgba(42, 180, 116, 1)',
              fill: true
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: true,
              position: 'top',
              labels: {
                font: {
                  family: '"Quicksand", sans-serif',
                  size: 14
                }
              }
            },
            tooltip: {
              backgroundColor: 'rgba(12, 34, 57, 0.8)',
              titleFont: {
                family: '"Quicksand", sans-serif',
                size: 14
              },
              bodyFont: {
                family: '"Quicksand", sans-serif',
                size: 13
              },
              padding: 12
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              grid: {
                color: 'rgba(0, 0, 0, 0.05)'
              },
              ticks: {
                font: {
                  family: '"Quicksand", sans-serif'
                }
              }
            },
            x: {
              grid: {
                display: false
              },
              ticks: {
                font: {
                  family: '"Quicksand", sans-serif'
                }
              }
            }
          }
        }
      });
    });

    // Toggling settings dropdown
    const settingsButton = document.querySelector('.settings-button');
    const settingsMenu = document.getElementById('settings-menu');
    
    settingsButton.addEventListener('click', function() {
      const expanded = this.getAttribute('aria-expanded') === 'true';
      this.setAttribute('aria-expanded', !expanded);
      settingsMenu.hidden = expanded;
    });
  });
</script>
</body>
</html>